<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Monitor de Execuções de Jobs</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Tabulator CSS (local) -->
  <link href="./vendor/tabulator.min.css" rel="stylesheet" />
    <!-- Flatpickr CSS -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="./style.css" rel="stylesheet" />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <span class="navbar-brand">Monitor de Jobs</span>
        <div class="ms-auto d-flex align-items-center gap-3">
          <div class="form-check form-switch text-white">
            <input class="form-check-input" type="checkbox" id="toggleUTC" />
            <label class="form-check-label" for="toggleUTC">Exibir em UTC</label>
          </div>
        </div>
      </div>
    </nav>

    <main class="container my-4">
      <!-- Importação (oculta da interface) -->
      <section class="mb-4" style="display: none;">
        <div class="row g-3">
          <div class="col-md-6">
            <label for="fileInput" class="form-label">Importar arquivo JSON</label>
            <input class="form-control" type="file" id="fileInput" accept="application/json" />
          </div>
          <div class="col-md-6">
            <label class="form-label">Ou arraste e solte</label>
            <div id="dropZone" class="border border-2 border-secondary rounded p-3 text-center bg-white">
              Arraste o arquivo JSON aqui
            </div>
          </div>
        </div>
        <!-- Progress bar para importação -->
        <div class="progress mt-2 d-none" id="importProgress">
          <div class="progress-bar progress-bar-striped progress-bar-animated" 
               role="progressbar" style="width: 0%">
          </div>
        </div>
      </section>

      <!-- Filtros Globais -->
      <section class="mb-4">
        <div class="card">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-3">
                <label class="form-label" for="dateStart">Início</label>
                <input id="dateStart" class="form-control" placeholder="YYYY-MM-DD HH:mm" />
              </div>
              <div class="col-md-3">
                <label class="form-label" for="dateEnd">Fim</label>
                <input id="dateEnd" class="form-control" placeholder="YYYY-MM-DD HH:mm" />
              </div>
              <div class="col-md-2">
                <label class="form-label" for="idJobSelect">Job</label>
                <select id="idJobSelect" class="form-select">
                  <option value="">Todos</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label" for="textSearch">Busca de texto</label>
                <input id="textSearch" class="form-control" placeholder="Mensagem / status" />
              </div>
              <div class="col-md-12">
                <div class="d-flex flex-wrap gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="error" id="sevError" checked />
                    <label class="form-check-label" for="sevError">Erro</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="warning" id="sevWarning" checked />
                    <label class="form-check-label" for="sevWarning">Warning</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="info" id="sevInfo" />
                    <label class="form-check-label" for="sevInfo">Info</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="success" id="sevSuccess" />
                    <label class="form-check-label" for="sevSuccess">Sucesso</label>
                  </div>
                  <button id="applyFilters" class="btn btn-primary btn-sm">
                    <span id="applyFiltersText">Aplicar filtros</span>
                    <span id="applyFiltersSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
                  </button>
                  <button id="loadMore" class="btn btn-outline-primary btn-sm ms-2">
                    <span id="loadMoreText">Carregar mais dados</span>
                    <span id="loadMoreSpinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
                  </button>
                  <div id="loadMoreInfo" class="ms-3 text-muted small align-self-center d-none"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Abas -->
      <ul class="nav nav-tabs" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">Overview</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="incidentes-tab" data-bs-toggle="tab" data-bs-target="#incidentes" type="button" role="tab">Incidentes</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="jobs-tab" data-bs-toggle="tab" data-bs-target="#jobs" type="button" role="tab">Jobs</button>
        </li>
      </ul>
      <div class="tab-content p-3 bg-white border border-top-0 rounded-bottom" id="tabContent">
        <div class="tab-pane fade show active" id="overview" role="tabpanel">
          <div id="kpiRow" class="row g-3 mb-3">
            <!-- KPIs serão renderizados aqui -->
          </div>
          <div>
            <canvas id="trendChart" height="100"></canvas>
          </div>
          <!-- Indicador de carregamento geral -->
          <div id="generalLoadingIndicator" class="text-center py-4 d-none">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Carregando...</span>
            </div>
            <div class="mt-2 text-muted">Carregando dados...</div>
          </div>
        </div>
        <div class="tab-pane fade" id="incidentes" role="tabpanel">
          <div id="incidentsTable" class="mt-2"></div>
          <!-- Indicador de carregamento para incidentes -->
          <div id="incidentsLoadingIndicator" class="text-center py-4 d-none">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Carregando...</span>
            </div>
            <div class="mt-2 text-muted">Carregando incidentes...</div>
          </div>
        </div>
        <div class="tab-pane fade" id="jobs" role="tabpanel">
          <div id="jobsTable" class="mt-2"></div>
        </div>
      </div>
    </main>

    <!-- Dependencies via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.5.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="./vendor/tabulator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/zod@3.23.8/lib/index.umd.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- App (modules) -->
    <script type="module" src="./app.js"></script>
  </body>
</html>
